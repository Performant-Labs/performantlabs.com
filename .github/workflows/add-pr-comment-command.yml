name: Add PR Comment

on:
  repository_dispatch:
    types: [add-pr-comment-command]  

jobs:
  add_comment:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Add reaction to comment with command
      uses: peter-evans/create-or-update-comment@v3
      with:
        comment-id: ${{ github.event.client_payload.github.payload.comment.id }}
        reaction-type: hooray  

    - name: Create comment
      uses: peter-evans/create-or-update-comment@v3
      with:
        issue-number: ${{ github.event.pull_request.number }}
        body: |
          This is an automated comment.
        reactions: '+1'

    - name: Create URL to the run output
      id: vars
      run: echo "run-url=https://github.com/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID" >> $GITHUB_OUTPUT

    - name: Create comment
      uses: peter-evans/create-or-update-comment@v2
      with:
        token: ${{ secrets.GH_PAT }}
        repository: ${{ github.event.client_payload.github.payload.repository.full_name }}
        issue-number: ${{ github.event.client_payload.github.payload.issue.number }}
        body: |
          [Command run output][1]

            [1]: ${{ steps.vars.outputs.run-url }}
