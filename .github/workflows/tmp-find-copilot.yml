on:
  workflow_dispatch:
  pull_request:

jobs:
  Find-Copilot-Name:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ” Get Copilot Bot ID
        id: get_bot_id
        uses: actions/github-script@v7
        with:
          github-token: ${{ env.GH_PAT }}
          script: |
            const { data } = await github.graphql(`
              query CopilotBotID($owner: String!, $repo: String!) {
                repository(owner: $owner, name: $repo) {
                  suggestedActors(capabilities: [CAN_BE_ASSIGNED], first: 10) {
                    nodes {
                      login
                      __typename
                    }
                  }
                }
              }
            `, {
              owner: context.repo.owner,
              repo: context.repo.repo,
            });

            core.info(JSON.stringify(data.repository.suggestedActors));

            // Look for the specific bot login, often 'copilot-swe-agent'
            const copilotBot = data.repository.suggestedActors.nodes.find(
              node => node.login === 'copilot' || node.login === 'copilot-swe-agent'
            );

            if (copilotBot) {
              core.setOutput('copilot_login', copilotBot.login);
              core.info(`Found Copilot Bot Login: ${copilotBot.login}`);
            } else {
              core.setFailed('Copilot bot not found in suggested assignees. Check repo settings.');
            }
